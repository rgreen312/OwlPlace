(window.webpackJsonpclient=window.webpackJsonpclient||[]).push([[0],{204:function(e,t,n){e.exports=n(439)},209:function(e,t,n){},210:function(e,t,n){},379:function(e,t,n){},423:function(e,t,n){},424:function(e,t,n){},425:function(e,t,n){},438:function(e,t,n){},439:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(7),c=(n(209),n(49)),i=n(93),s=n(98),l=n(94),u=n(97),f=(n(210),n(51)),p=n(41),m=Object(p.f)(function(e){var t=e.children,n=e.location.pathname;return Object(a.useEffect)(function(){window.scrollTo(0,0)},[n]),t||null}),g=n(30),d=n(52),h=n(96),v=n(192),b=n(100),O=(n(379),function(e){var t=e.onColorChange,n=e.onComplete,r=e.onCancel,c=e.className,i=e.style,s=Object(a.useState)({r:0,g:0,b:0}),l=Object(h.a)(s,2),u=l[0];l[1];return o.a.createElement("div",{className:c,style:i},o.a.createElement(v.SketchPicker,{color:u,onChange:function(e){return function(e){t(e)}({r:e.rgb.r,b:e.rgb.b,g:e.rgb.g})}}),o.a.createElement("div",{className:"button-bar"},o.a.createElement(b.a,{onClick:function(){return n()},className:"okay-button"},"Okay"),o.a.createElement(b.a,{onClick:r,className:"cancel-button"},"Cancel")))}),E=(n(423),n(442)),C=n(440),y=n(12),w=n(3),j=n.n(w),k=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e))).canvasRef=void 0,n.canvasRef=Object(a.createRef)(),n.state={showColorPicker:!1,previousColor:null,isDrag:!1,translateX:0,translateY:0,dragStartX:0,dragStartY:0,colorPickerX:0,colorPickerY:0},n.onCancel=n.onCancel.bind(Object(d.a)(n)),n.onComplete=n.onComplete.bind(Object(d.a)(n)),n.onColorChange=n.onColorChange.bind(Object(d.a)(n)),n.updateTranslate=n.updateTranslate.bind(Object(d.a)(n)),n}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.canvasRef.current.width=1e3,this.canvasRef.current.height=1e3;var t=this.canvasRef.current.getContext("2d");t&&this.props.registerContext(t),t.imageSmoothingEnabled=!1,t.fillStyle="#000000",t.fillRect(0,0,1e3,500),t.fillStyle="#ff0000",t.fillRect(0,500,1e3,500),this.canvasRef.current.addEventListener("mousemove",function(t){if(!e.state.showColorPicker){var n=e.getMousePos(e.canvasRef.current,t),a=n.x,o=n.y;e.props.updatePosition(a,o)}}),this.canvasRef.current.addEventListener("mouseout",function(){e.state.showColorPicker||e.props.onMouseOut()}),this.canvasRef.current.addEventListener("mousedown",function(t){var n=e.props.zoomFactor,a=e.state,o=a.translateX,r=a.translateY,c=t.clientX-o,i=t.clientY-r,s=t.clientX+n,l=t.clientY;s+220>window.innerWidth&&(s-=220),l+337>window.innerHeight-70&&(l-=337),e.setState({dragStartX:c,dragStartY:i,colorPickerX:s,colorPickerY:l}),e.canvasRef.current.addEventListener("mousemove",e.updateTranslate)}),this.canvasRef.current.addEventListener("mouseup",function(t){e.canvasRef.current.removeEventListener("mousemove",e.updateTranslate);var n=e.props,a=n.canUpdatePixel,o=n.updatePosition;if(!e.state.isDrag)if(a){var r=e.getMousePos(e.canvasRef.current,t);o(r.x,r.y),e.showColorPicker();var c=e.props.position,i=e.canvasRef.current.getContext("2d").getImageData(c.x-1,c.y-1,1,1);e.setState({previousColor:{r:i.data[0],g:i.data[1],b:i.data[2]}})}else E.a.error({message:"Cannot update pixel",description:"Sorry, you cannot update a pixel at this time. Please wait until the timer is up in order to update another pixel."});e.setState({isDrag:!1})})}},{key:"updateTranslate",value:function(e){var t=this.state,n=t.dragStartX,a=t.dragStartY,o=e.clientX-n,r=e.clientY-a;this.onCancel(),this.setState({isDrag:!0,translateX:o,translateY:r})}},{key:"getMousePos",value:function(e,t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}},{key:"onCancel",value:function(){if(this.hideColorPicker(),this.props.position&&this.state.previousColor){var e=this.canvasRef.current.getContext("2d"),t=this.props.position.x,n=this.props.position.y,a=this.state.previousColor;e.fillStyle="rgb("+a.r+","+a.g+","+a.b+")",e.fillRect(t-1,n-1,1,1)}this.setState({previousColor:null})}},{key:"onComplete",value:function(){var e=this.props.onUpdatePixel;this.hideColorPicker(),e({r:0,g:0,b:0},0,0)}},{key:"onColorChange",value:function(e){var t=this.canvasRef.current.getContext("2d"),n=this.props.position.x-1,a=this.props.position.y-1;t.fillStyle="rgb(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")"),t.fillRect(n,a,1,1)}},{key:"showColorPicker",value:function(){this.setState({showColorPicker:!0})}},{key:"hideColorPicker",value:function(){this.setState({showColorPicker:!1})}},{key:"render",value:function(){var e=this,t=this.props,n=(t.receivedError,t.zoomFactor),a=t.setZoomFactor,r=t.isLoading,c=this.state,i=c.translateX,s=c.translateY,l=c.isDrag,u=c.colorPickerX,f=c.colorPickerY;return o.a.createElement("div",null,r&&o.a.createElement(C.a,{className:"spinner-style",size:"large"}),o.a.createElement("div",{className:j()({"hide-canvas":r,"canvas-container":!0})},this.state.showColorPicker&&o.a.createElement(O,{onColorChange:function(t){return e.onColorChange(t)},onCancel:function(){return e.onCancel()},onComplete:this.onComplete,className:"color-picker",style:{top:"".concat(f,"px"),left:"".concat(u,"px")}}),o.a.createElement("div",{className:j()({"pan-canvas":!0,"drag-canvas":l}),style:{transform:"translate(".concat(i,"px, ").concat(s,"px)")}},o.a.createElement("div",{className:"zoom-canvas",style:{transform:"scale(".concat(n,", ").concat(n,")")}},o.a.createElement("canvas",{ref:this.canvasRef}))),o.a.createElement("div",{className:"zoom-controls"},o.a.createElement(y.a,{type:"plus-circle",onClick:function(){a(n+10),e.onCancel()},className:"zoom-icon"}),o.a.createElement(y.a,{type:"minus-circle",onClick:function(){a(n-10),e.onCancel()},className:"zoom-icon"}))))}}]),t}(a.Component),S=function(e){return e.websocket.socket||void 0},N=function(e){return e.websocket.receivedError},P=function(e){return e.websocket.isLoading},T=function(e){return e.canvas.curPosition||void 0},x=function(e){return e.canvas.zoomFactor},R=function(e){return e.canvas.timeToNextChange},I=function(e){return 0===e.canvas.timeToNextChange},L=function(e){return{type:"canvas/SET_TIME_REMAINING",payload:{time:e}}},_={registerContext:function(e){return function(t){t(function(e){return{type:"canvas/REGISTER_CONTEXT",payload:{context:e}}}(e))}},updatePosition:function(e,t){return function(n,a){var o=a(),r=x(o);n(function(e,t){return{type:"canvas/UPDATE_POSITION",payload:{x:e,y:t}}}(Math.ceil(e/r),Math.ceil(t/r)))}},onMouseOut:function(){return function(e){e({type:"canvas/CLEAR_POSITION"})}},setZoomFactor:function(e){return function(t,n){if(!(e<0)){var a=function(e){return e.canvas.canvasContext||void 0}(n());a&&a.scale(e,e),t({type:"canvas/SET_ZOOM",payload:{zoom:e}})}}},onUpdatePixel:function(e,t,n){return function(e){console.log("updated pixel"),e({type:"canvas/UPDATE_PIXEL_SUCCESS"})}}},A=Object(g.b)(function(e){return{receivedError:N(e),zoomFactor:x(e),position:T(e),isLoading:P(e),canUpdatePixel:I(e)}},_)(k),M=function(){return o.a.createElement(A,null)},U=(n(424),function(){return o.a.createElement("div",{className:"about-page"},o.a.createElement("h1",null,"OwlPlace"),o.a.createElement("h1",null,"About"),o.a.createElement("p",null,"OwlPlace is a collaborative canvas editing application that allows users to alter the contents of a shared canvas. Users will be able to change the color of a single pixel within the canvas once per fixed time period (likely once every couple minutes). When used by a large number of users, groups of people may even collaborate and work together to create large and intricate designs within the image for all to see. OwlPlace will ensure that all users will see the same image at any given time, even updating pixels live as other users change them."),o.a.createElement("p",null,"Users will be able to access OwlPlace through a web application. When visiting for the first time, users will be prompted to login with Google. Once logged in, users will be able to view the canvas in its entirety, zoom in on specific sections, see live updates to the canvas, and update pixels. The goal of the front end of this application is to make the user experience as simple as possible while still being engaging."),o.a.createElement("p",null,"This application will be built on top of a distributed database. This distributed database will be a custom solution implemented by our team using the RAFT protocol to ensure consistency across servers. Each server will run its own instance of the image control code and maintain its own local database. RAFT will be used to maintain consistency of each server\u2019s local database and ensure that machines can recover the correct data if they go offline and come back into the network. While the image and user data systems will be somewhat separate from one another, they will use the RAFT protocol API to ensure that local databases do not become out of sync with one another."),o.a.createElement("p",null,"For more information, visit the"," ",o.a.createElement("a",{href:"https://docs.google.com/document/d/13_bi5Vf5WNiZuDCWOdyBopANCUBl-Cyt7jK-sCeUW2s/edit?usp=sharing"},"functional specification"),"."))}),X="websocket/START_CONNECT",D="websocket/CONNECT_SUCCESS",Y="websocket/CONNECT_ERROR",z="websocket/CLOSE_CONNNECTION",F=4;var G,W,B,J=function(){return{type:z}},Z=function(e,t,n,a,o,r){return JSON.stringify({type:1,userId:e,x:t,y:n,r:a,g:o,b:r})},H=function(e){var t=e.sendUpdateMessage,n=e.sendLoginMessage;return o.a.createElement("div",{className:"testing-page"},o.a.createElement("h2",null,"TESTING AREA"),o.a.createElement("p",null,'Click "Pixel 1" to send an update message to the server!'),o.a.createElement("button",{onClick:function(){return t("user1",10,400,255,255,255)},id:"p1"}," Pixel 1 "),o.a.createElement("button",{onClick:function(){return n("testemail@gmail.com")},id:"login"}," User Login "))},q={sendUpdateMessage:function(e,t,n,a,o,r){return function(c,i){var s=S(i());s&&s.send(Z(e,t,n,a,o,r))}},sendLoginMessage:function(e){return function(t,n){console.log("sending login message for email: "+e);var a=S(n());a&&a.send(function(e){return JSON.stringify({type:2,email:e})}(e))}}},V=Object(g.b)(null,q)(H),K=n(140),Q=n(443),$=n(441),ee=(n(425),function(e){var t=e.onLogin,n=e.isLoggedIn,r=e.name,c=e.onLogout,i=e.timeToNextChange,s=e.setTimeRemaining;window.onGoogleScriptLoad=function(){console.log("The google script has really loaded, cool!")};var l=n?o.a.createElement("div",{className:"name-label"},"Hi, ",r):o.a.createElement(b.a,{className:"login-button",onClick:t},"Login"),u=Object(p.e)().pathname,m=o.a.createElement(K.a,null,o.a.createElement(K.a.Item,null,"about"!=u.substring(u.length-5,u.length)?o.a.createElement(f.b,{to:"/about"},"About"):o.a.createElement(f.b,{to:"/"},"Home")),n&&o.a.createElement(K.a.Item,{onClick:c},"Sign Out"),"localhost"==window.location.hostname&&o.a.createElement(K.a.Item,null,o.a.createElement(f.b,{to:"/testing"},"Testing"))),g=o.a.createElement(Q.a,{key:"more",overlay:m},o.a.createElement(b.a,{style:{border:"none",padding:0}},o.a.createElement(y.a,{type:"ellipsis",style:{fontSize:20,verticalAlign:"top"}}))),d=Object(a.useState)(i),v=Object(h.a)(d,2),O=v[0],C=v[1];Object(a.useEffect)(function(){C(i)},[i]),Object(a.useEffect)(function(){var e=null;return O<=0?(clearInterval(e),s(0),void E.a.success({message:"Place another pixel",description:"You can now update another pixel on the canvas."})):(e=setInterval(function(){C(function(e){return e-1e3})},1e3),function(){return clearInterval(e)})},[O]);var w=o.a.createElement("div",{className:"timer"},Math.floor(O/6e4),":",("0"+Math.floor(O%6e4/1e3)).slice(-2));return o.a.createElement($.a,{title:"OwlPlace",subTitle:"change the canvas one pixel at a time",extra:[w,l,g]})}),te=n(54),ne=n.n(te),ae=n(99),oe="login/LOGIN_START",re="login/LOGIN_SUCCESS",ce="login/LOGIN_ERROR",ie="login/SIGN_OUT",se=function(){return{type:oe}},le=function(e,t,n){return{type:re,payload:{name:e,id:t,email:n}}},ue=function(e){return e.login.isLoggedIn},fe=function(e){return e.login.name||void 0},pe={onLogin:function(){return function(){var e=Object(ae.a)(ne.a.mark(function e(t){var n,a,o;return ne.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t(se()),n=new Promise(function(e){gapi.load("auth2",function(){gapi.auth2.init({client_id:"634069824484-ch6gklc2fevg9852aohe6sv2ctq7icbk.apps.googleusercontent.com"}),e()})}),e.next=4,n;case 4:return e.next=6,gapi.auth2.getAuthInstance().signIn();case 6:a=gapi.auth2.getAuthInstance().currentUser.get(),o=a.getBasicProfile(),t(le(o.getName(),o.getId(),o.getEmail()));case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},onLogout:function(){return function(){var e=Object(ae.a)(ne.a.mark(function e(t){var n;return ne.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=gapi.auth2.getAuthInstance(),e.next=3,n.signOut();case 3:t({type:ie});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},setTimeRemaining:function(e){return function(t){e<0&&t(L(0)),t(L(e))}}},me=Object(g.b)(function(e){return{isLoggedIn:ue(e),name:fe(e),timeToNextChange:R(e)}},pe)(ee),ge=(n(438),function(){return o.a.createElement("div",null,o.a.createElement("footer",null,"Made with \u2665 by COMP 413 @ Rice"))}),de=function(){return o.a.createElement("div",{className:"error-page"},"There was an error.")},he=function(){return o.a.createElement(f.a,{basename:"/OwlPlace"},o.a.createElement(m,null,o.a.createElement(me,null),o.a.createElement(p.a,{exact:!0,path:"/",component:M}),o.a.createElement(p.a,{path:"/about",component:U}),o.a.createElement(p.a,{path:"/error",component:de}),o.a.createElement(p.a,{path:"/testing",component:V}),o.a.createElement(ge,null)))},ve=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.checkLogin(),this.props.openConnection()}},{key:"render",value:function(){return o.a.createElement(he,null)}}]),t}(o.a.Component),be={checkLogin:function(){return function(){var e=Object(ae.a)(ne.a.mark(function e(t){return ne.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t(se()),e.abrupt("return",new Promise(function(e){var n=setTimeout(function(){return Promise.resolve()},3e3);Promise.race([n,function(){return new Promise(function(e){for(;!window.gapi;);e()})}]),window.gapi&&gapi.load("auth2",function(){gapi.auth2.init({client_id:"634069824484-ch6gklc2fevg9852aohe6sv2ctq7icbk.apps.googleusercontent.com"}).then(function(){if(gapi.auth2.getAuthInstance().isSignedIn.get()){var e=gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile();t(le(e.getName(),e.getName(),e.getEmail()))}}),e()})}));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},openConnection:function(){return function(e){e({type:X});var t=new WebSocket("ws://".concat("127.0.0.1:3001","/ws"));t.onopen=function(){t.send(JSON.stringify({type:0,message:"Hi From the Client! The websocket just opened"})),t.send(Z("AAAAAA",6,9,4,2,0)),e(function(e){return{type:D,payload:{socket:e}}}(t))},t.onclose=function(t){e(J())},t.onerror=function(t){e(function(e){return{type:Y,payload:{error:e}}}(t.type))},t.onmessage=function(e){var t=e.data;console.log("data is"+t),console.log(typeof t);var n=JSON.parse(t);switch(n.type){case F:var a=n.formatString;console.log("Received an IMAGE message from the server!"),console.log("Format string: "+a);break;case 5:console.log("Received a TESTING message from the server!"),console.log("Message: "+n.msg);default:console.log("Received a message from the server of an unknown type, message: "+t)}}}}},Oe=Object(g.b)(null,be)(ve),Ee=n(22),Ce=n(6);function ye(e,t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,a=arguments.length>1?arguments[1]:void 0,o=t[a&&a.type];return o?o(n,a):n}}var we,je,ke,Se,Ne,Pe,Te,xe,Re=ye(null,(G={},Object(Ce.a)(G,Y,function(){return null}),Object(Ce.a)(G,"canvas/REGISTER_CONTEXT",function(e,t){return t.payload.context}),G)),Ie=ye(null,(W={},Object(Ce.a)(W,"canvas/CLEAR_POSITION",function(){return null}),Object(Ce.a)(W,"canvas/UPDATE_POSITION",function(e,t){return t.payload}),W)),Le=ye(41,Object(Ce.a)({},"canvas/SET_ZOOM",function(e,t){return t.payload.zoom})),_e=ye(0,(B={},Object(Ce.a)(B,"canvas/SET_TIME_REMAINING",function(e,t){return t.payload.time}),Object(Ce.a)(B,"canvas/UPDATE_PIXEL_SUCCESS",function(){return 3e5}),B)),Ae=Object(Ee.c)({canvasContext:Re,curPosition:Ie,zoomFactor:Le,timeToNextChange:_e}),Me=ye(!1,(we={},Object(Ce.a)(we,oe,function(){return!1}),Object(Ce.a)(we,ce,function(){return!1}),Object(Ce.a)(we,ie,function(){return!1}),Object(Ce.a)(we,re,function(){return!0}),we)),Ue=ye(null,(je={},Object(Ce.a)(je,oe,function(){return null}),Object(Ce.a)(je,ce,function(){return null}),Object(Ce.a)(je,ie,function(){return null}),Object(Ce.a)(je,re,function(e,t){return t.payload.name}),je)),Xe=ye(null,(ke={},Object(Ce.a)(ke,oe,function(){return null}),Object(Ce.a)(ke,ce,function(){return null}),Object(Ce.a)(ke,ie,function(){return null}),Object(Ce.a)(ke,re,function(e,t){return t.payload.email}),ke)),De=ye(null,(Se={},Object(Ce.a)(Se,oe,function(){return null}),Object(Ce.a)(Se,ce,function(){return null}),Object(Ce.a)(Se,ie,function(){return null}),Object(Ce.a)(Se,re,function(e,t){return t.payload.id}),Se)),Ye=Object(Ee.c)({isLoggedIn:Me,name:Ue,email:Xe,id:De}),ze=ye(null,(Ne={},Object(Ce.a)(Ne,X,function(){return null}),Object(Ce.a)(Ne,Y,function(){return null}),Object(Ce.a)(Ne,z,function(){return null}),Object(Ce.a)(Ne,D,function(e,t){return t.payload.socket}),Ne)),Fe=ye(!1,(Pe={},Object(Ce.a)(Pe,X,function(){return!1}),Object(Ce.a)(Pe,Y,function(){return!1}),Object(Ce.a)(Pe,z,function(){return!1}),Object(Ce.a)(Pe,D,function(){return!0}),Pe)),Ge=ye(!1,(Te={},Object(Ce.a)(Te,X,function(){return!1}),Object(Ce.a)(Te,Y,function(){return!0}),Object(Ce.a)(Te,z,function(){return!1}),Object(Ce.a)(Te,D,function(){return!1}),Te)),We=ye(!1,(xe={},Object(Ce.a)(xe,X,function(){return!0}),Object(Ce.a)(xe,Y,function(){return!1}),Object(Ce.a)(xe,z,function(){return!1}),Object(Ce.a)(xe,D,function(){return!1}),xe)),Be=Object(Ee.c)({socket:ze,isConnected:Fe,receivedError:Ge,isLoading:We}),Je=n(202);n.d(t,"store",function(){return qe});var Ze=Object(Ee.c)({canvas:Ae,login:Ye,websocket:Be}),He=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Ee.d,qe=Object(Ee.e)(Ze,He(Object(Ee.a)(Je.a)));Object(r.render)(o.a.createElement(g.a,{store:qe},o.a.createElement(Oe,null)),document.getElementById("root"))}},[[204,1,2]]]);
//# sourceMappingURL=main.e5dc6fe3.chunk.js.map